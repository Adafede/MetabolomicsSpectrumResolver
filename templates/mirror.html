(% extends "minimal.html" %)

(% block content %)

<div class="container-fluid">
    <div class="panel panel-default">
        <div class="row">
            <div class="col-sm"></div>
            <div class="col-sm text-center">
                <h2>Spectrum Values</h2>
            </div>
            <div class="col-sm"></div>
        </div>

        <hr>

        <div class="row">
            <div class="col-sm"></div>
            <div class="col-sm text-center">
                Spectrum SVG
            </div>
            <div class="col-sm"></div>
        </div>

        <div class="row">
            <div class="col-sm"></div>
            <div class="col-sm text-center">
                <img id="spectrumrender" src="/svg/mirror?usi1=((usi1))&usi2=((usi2))&annotate_peaks"/>
            </div>
            <div class="col-sm"></div>
        </div>

        <div class="row">
            <div class="col-sm-3"></div>
            <div class="col-sm-6 text-center">
                <h2>Drawing Controls</h2>
                <br>
                <div class="form-group row">
                    <label for="annotate_peaks">Show Labels</label>
                </div>
                <div class="form-group row">
                    <div class="col">
                        <select id="annotate_peaks" class="form-control">
                            <option selected>Yes</option>
                            <option>No</option>
                        </select>
                    </div>

                    <div class="col">
                        <input type="text" id="annotate_threshold" class="form-control" placeholder="Label Threshold - Percent">
                    </div>

                </div>
                <div class="form-group row">
                    <div class="col">
                        <input type="text" id="mz_min" class="form-control" placeholder="Min m/z">
                    </div>
                    <div class="col">
                        <input type="text" id="mz_max" class="form-control" placeholder="Max m/z">
                    </div>
                </div>
                <button class="btn btn-primary" onclick=updateFigure()>Update</button>
                <br>
                <br>
                <a id="controlsvgdownload" href="/svg/mirror?usi1=((usi1))&usi2=((usi2))&annotate_peaks" download="((usi1))_((usi2)).svg">
                    <button class="btn btn-primary" >Download SVG</button>
                </a>
                <a id="controlpngdownload" href="/png/mirror?usi1=((usi1))&usi2=((usi2))&annotate_peaks" download="((usi1))_((usi2)).png">
                    <button class="btn btn-primary" >Download PNG</button>
                </a>
                <br>
                <br>
            </div>
            <div class="col-sm-3"></div>
        </div>
</div>



<script type="text/javascript">

    let usi1 = '((usi1))';
    let usi2 = '((usi2))';

    function updateFigure() {
        let svg_url = "/svg/mirror?usi1=" + usi1 + "&usi2=" + usi2;
        let png_url = "/svg/mirror?usi1=" + usi1 + "&usi2=" + usi2;
        let draw_parameters = "";

        if($("#annotate_peaks").val() === "Yes"){
            draw_parameters += "&annotate_peaks";
        }
        if($("#annotate_threshold").val().length > 0){
            thresh = parseFloat($("#annotate_threshold").val()) / 100;
            draw_parameters += `&annotate_threshold=${annotate_threshold}`;
        }
        if($("#mz_min").val().length > 0){
            mz_min = $("#mz_min").val();
            draw_parameters += `mz_min=${mz_min}&annotate_peaks`;
        }
        if($("#mz_max").val().length > 0){
            mz_max = $("#mz_max").val();
            draw_parameters += `&mz_max=${mz_max}&annotate_peaks`;
        }

        $("#spectrumrender")[0].src = svg_url + draw_parameters;
        $("#controlsvgdownload")[0].href = svg_url + draw_parameters;
        $("#controlpngdownload")[0].href = png_url + draw_parameters;
    }
</script>

(% endblock %)
