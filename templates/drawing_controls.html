<div class="row">
    <div class="col-6 offset-3">
        <h3 class="text-center">Drawing Controls</h3>
        <div class="form-group row">
            <div class="col-4 col-form-label font-weight-bold text-right">Figure size</div>
            <div class="col-8 input-group">
                <input type="number" id="width" class="form-control" min="1" max="20" value="10" step="any">
                <div class="input-group-append">
                    <span class="input-group-text">"</span>
                </div>
                <span class="col-form-label">&nbsp;X&nbsp;</span>
                <input type="number" id="height" class="form-control" min="1" max="20" value="6" step="any">
                <div class="input-group-append">
                    <span class="input-group-text">"</span>
                </div>
            </div>
        </div>
        <div class="form-group row">
            <div class="col-4 col-form-label font-weight-bold text-right">Mass range</div>
            <div class="col-8 input-group">
                <input type="number" id="mz_min" class="form-control" min="0" step="any">
                <div class="input-group-append">
                    <span class="input-group-text"><i>m/z</i></span>
                </div>
                <span class="col-form-label">&nbsp;&ndash;&nbsp;</span>
                <input type="number" id="mz_max" class="form-control" min="0" step="any">
                <div class="input-group-append">
                    <span class="input-group-text"><i>m/z</i></span>
                </div>
            </div>
        </div>
        <div class="form-group row">
            <div class="col-4 col-form-label font-weight-bold text-right">Intensity range</div>
            <div class="col-8 input-group">
                <span class="col-form-label">Maximum intensity:&nbsp;</span>
                <input type="number" id="max_intensity" class="form-control" min="0" max="200" step="1">
                <div class="input-group-append">
                    <span class="input-group-text">&percnt;</span>
                </div>
            </div>
        </div>
        <div class="form-group row">
            <div class="col-4 col-form-label font-weight-bold text-right">Grid</div>
            <div class="col-8">
                <div class="form-check">
                    <input type="checkbox" class="form-check-input" id="grid" checked="checked">
                    <label class="form-check-label col-form-label" for="grid">&nbsp;Display grid</label>
                </div>
            </div>
        </div>
        <div class="form-group row">
            <div class="col-4 col-form-label font-weight-bold text-right">Peak labeling</div>
            <div class="col-8">
                (% for spectrum in peaks %)
                    (% set spectrum_loop = loop %)
                    <table class="table">
                        <thead>
                            <tr class="align-self-center">
                                <th><button class="btn btn-link remove_button_css" data-toggle="collapse" data-target="#peaks_((spectrum_loop.index))"><i class="fas fa-caret-up"></i></button></th>
                                <th class="text-right">Mass (<i>m/z</i>)</th>
                                <th class="text-right">Intensity</th>
                            </tr>
                        </thead>
                        <tbody class="collapse" id="peaks_((spectrum_loop.index))">
                            (% for peak in spectrum %)
                                <tr>
                                    <td class="text-center"><input type="checkbox" class="form-check-input" id="annotate_peak_((spectrum_loop.index - 1))-((loop.index - 1))"></td>
                                    <td class="text-right">(( '{:.4f}'.format(peak[0]) ))</td>
                                    <td class="text-right">(( '{:.0%}'.format(peak[1]) ))</td>
                                </tr>
                            (% endfor %)
                        </tbody>
                    </table>
                (% endfor %)
            </div>
        </div>
        <div class="form-group row">
            <div class="col-4 col-form-label font-weight-bold text-right">Label precision</div>
            <div class="col-8 input-group">
                <span class="col-form-label">Decimal places:&nbsp;</span>
                <input type="number" id="annotate_precision" class="form-control" min="0" max="10" value="4" step="1">
            </div>
        </div>
        <div class="form-group row">
            <div class="col-4 col-form-label font-weight-bold text-right">Label rotation</div>
            <div class="col-8 input-group">
                <input type="number" id="annotation_rotation" class="form-control" min="0" max="90" value="90" step="1">
                <div class="input-group-append">
                    <span class="input-group-text">&deg;</span>
                </div>
            </div>
        </div>
        <div class="form-group row">
            <div class="col-2 offset-5">
                <button class="btn btn-primary" onclick=updateFigure()>Update</button>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    function getDrawingControls() {
        let annotate_peaks = [];
        input_list = document.getElementsByTagName('input');
        for (let i = 0; i < input_list.length; i++) {
            if (input_list[i].id.startsWith('annotate_peak_') && input_list[i].checked) {
                annotate_peaks.push(input_list[i].id.substring(input_list[i].id.lastIndexOf('_') + 1));
            }
        }
        return `&width=${$("#width").val()}` +
            `&height=${$("#height").val()}` +
            `&mz_min=${$("#mz_min").val()}` +
            `&mz_max=${$("#mz_max").val()}` +
            `&max_intensity=${$("#max_intensity").val()}` +
            `&grid=${$("#grid").attr("checked")}` +
            `&annotate_peaks=${JSON.stringify(annotate_peaks)}` +
            `&annotate_precision=${$("#annotate_precision").val()}` +
            `&annotation_rotation=${$("#annotation_rotation").val()}`;
    }
</script>
